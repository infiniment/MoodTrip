<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>무드트립 - 감정으로 떠나는 특별한 여행</title>

  <!-- Google Fonts 링크입니다. -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@100;200;300;400;500;600;700;800;900&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- CSS 파일들 - Thymeleaf 방식으로 변경 -->

  <link rel=" stylesheet" th:href="@{/css/fix/header.css}">
  <link rel="stylesheet" th:href="@{/css/fix/footer.css}">
  <link rel="stylesheet" th:href="@{/css/fix/header-after.css}">
  <link rel="stylesheet" th:href="@{/css/mainpage/mainpage.css}">
</head>
</head>
<body>
<div th:if="${isLoggedIn}">
  <!-- 로그인된 사용자용 헤더 -->
  <th:block th:replace="~{fix/header-after-login :: header}"></th:block>
</div>
<div th:unless="${isLoggedIn}">
  <!-- 로그인 안된 사용자용 헤더 -->
  <th:block th:replace="~{fix/header :: header}"></th:block>
</div>

<!-- 메인 히어로 섹션 첫번째 섹션에 뒤에 도형들 떠다니는 shape들-->
<section class="hero-section">
  <div class="hero-background">
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
      <div class="shape shape-4"></div>
    </div>
  </div>

  <!-- 좌측에 첫번째 섹션 container -->
  <div class="hero-container">
    <div class="hero-content">
      <div class="hero-badge">
        <span class="badge-text">✨ 감정 기반 맞춤 여행</span>
      </div>

      <h1 class="hero-title">
        <span class="title-line-1">오늘의 감정에 맞는</span>
        <span class="title-line-2">
          <span class="gradient-text">완벽한 여행</span>을 찾아보세요
        </span>
      </h1>

      <p class="hero-subtitle">
        당신의 마음 상태에 따라<br>
        최적의 여행지와 동행자를 추천해드립니다
      </p>

      <div class="hero-actions">
        <!-- Thymeleaf 링크로 변경 감정 검색 페이지로 이동 -->
        <a th:href="@{/emotions}" class="btn-primary-large">
          <span class="btn-icon">🎯</span>
          감정 기반 여행 찾기
          <span class="btn-arrow">→</span>
        </a>
        <button class="btn-secondary-outline" onclick="scrollToSection('travel-matching')">
          <span class="btn-icon">👥</span>
          동행자 찾기
        </button>
      </div>
    </div>

    <!-- 가운데에 감정별 여행 추천 -->
    <div class="hero-visual">
      <div class="emotion-cloud-container">
        <!-- 중앙 메인 텍스트 -->
        <div class="emotion-center">
          <div class="emotion-main-text">
            <span class="emotion-brand">MOOD TRIP</span>
            <span class="emotion-subtitle">감정을 찾아보세요</span>
          </div>
        </div>

        <!-- 감정 이모지들 -->
        <div class="floating-emotions">
          <div class="emotion-item" data-emotion="행복" style="--delay: 0s; --x: 30%; --y: 10%;">
            <span class="emotion-emoji">😊</span>
            <span class="emotion-label">행복</span>
          </div>
          <div class="emotion-item" data-emotion="설레임" style="--delay: 1s; --x: 95%; --y: 10%;">
            <span class="emotion-emoji">🤗</span>
            <span class="emotion-label">설레임</span>
          </div>
          <div class="emotion-item" data-emotion="평온" style="--delay: 2s; --x: 30%; --y: 75%;">
            <span class="emotion-emoji">😌</span>
            <span class="emotion-label">평온</span>
          </div>
          <div class="emotion-item" data-emotion="신남" style="--delay: 3s; --x: 95%; --y: 75%;">
            <span class="emotion-emoji">🥳</span>
            <span class="emotion-label">신남</span>
          </div>
          <div class="emotion-item" data-emotion="힐링" style="--delay: 4s; --x: 10%; --y: 47%;">
            <span class="emotion-emoji">🧘‍♀️</span>
            <span class="emotion-label">힐링</span>
          </div>
          <div class="emotion-item" data-emotion="모험" style="--delay: 5s; --x: 115%; --y: 47%;">
            <span class="emotion-emoji">🗺️</span>
            <span class="emotion-label">모험</span>
          </div>
          <div class="emotion-item" data-emotion="로맨틱" style="--delay: 6s; --x: 60%; --y: 0%;">
            <span class="emotion-emoji">💕</span>
            <span class="emotion-label">로맨틱</span>
          </div>
          <div class="emotion-item" data-emotion="자유" style="--delay: 7s; --x: 60%; --y: 90%;">
            <span class="emotion-emoji">🕊️</span>
            <span class="emotion-label">자유</span>
          </div>
        </div>

        <!-- 감정 연결선 효과 -->
        <div class="emotion-connections">
          <svg class="connection-svg" viewBox="0 0 400 300">
            <path class="connection-line" d="M 80,60 Q 200,150 320,80" />
            <path class="connection-line" d="M 60,225 Q 200,150 340,240" />
            <path class="connection-line" d="M 40,135 Q 200,150 360,150" />
          </svg>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 동행 매칭 섹션 -->
<!-- 동행 매칭 섹션 -->
<section class="travel-matching" id="travel-matching">
  <div class="section-container">
    <div class="section-header">
      <div class="section-badge">
        <span class="badge-icon">🤝</span>
        <span>함께하는 여행</span>
      </div>
      <h2 class="section-title">
        개인화된 <span class="gradient-text">동행 매칭</span> 서비스
      </h2>
      <p class="section-subtitle">
        취향과 성향이 맞는 여행 동반자를 만나<br>
        더욱 특별한 추억을 만들어보세요
      </p>
    </div>

    <!-- 동행 매칭 기능 소개  -->
    <div class="features-grid">
      <div class="feature-item">
        <div class="feature-icon">🏠</div>
        <h3 class="feature-title">방 만들기</h3>
        <p class="feature-desc">원하는 여행 계획으로 직접 모임을 개설하고 동행자를 모집하세요</p>
      </div>
      <div class="feature-item">
        <div class="feature-icon">🔍</div>
        <h3 class="feature-title">방 찾기</h3>
        <p class="feature-desc">다양한 여행 모임 중에서 취향에 맞는 방을 찾아 참여하세요</p>
      </div>
      <div class="feature-item">
        <div class="feature-icon">💬</div>
        <h3 class="feature-title">실시간 소통</h3>
        <p class="feature-desc">동행자들과 실시간으로 여행 계획을 공유하고 소통하세요</p>
      </div>
    </div>

    <div class="cta-section">
      <!-- Thymeleaf 링크로 동행매칭 시작 페이지로 이동 -->
      <a th:href="@{/companion-rooms/start}" class="btn-primary-xl">
        <span class="btn-icon">🚀</span>
        동행매칭 서비스 시작하기
        <span class="btn-arrow">→</span>
      </a>
    </div>

    <!-- 방 목록 섹션 - 기존 하드코딩 제거하고 동적 데이터로 교체 -->
    <div class="rooms-section">
      <div class="rooms-header">
        <h3 class="rooms-title">🔥 이런 방은 어떠세요?</h3>
      </div>

      <div class="rooms-grid" id="roomsGrid">
        <!-- 동적 방 카드들 - 실제 데이터베이스에서 가져온 데이터 (최대 6개만 표시) -->
        <div th:each="room : ${popularRooms}" class="room-card">
          <div class="room-image">
            <img th:src="${room.roomImage}" th:alt="${room.roomName}"
                 onerror="this.src='/image/fix/moodtrip.png'">
            <div class="room-status"
                 th:classappend="${room.status == '모집완료'} ? 'completed' : (${room.status == '마감임박'} ? 'urgent' : 'active')"
                 th:text="${room.status}">모집중</div>
          </div>
          <div class="room-content">
            <h4 class="room-title" th:text="${room.roomName}">방 제목</h4>
            <div class="room-tags">
              <!-- 감정 태그는 나중에 EmotionRoom 연결시 구현 예정 -->
              <span class="tag-emotion"># 여행</span>
              <span class="tag-location" th:text="'# ' + ${room.location}"># 서울</span>
              <span class="tag-activity"># 관광</span>
            </div>
            <p class="room-description" th:text="${room.attractionName}">관광지명</p>
            <div class="room-info">
              <div class="room-participants">
                <span class="participants-count" th:text="${room.participantsInfo}">2 / 8</span>
                <span class="participants-label">참여현황</span>
              </div>
              <div class="room-period" th:text="${room.periodInfo}">25/07/1 - 25/07/25</div>
            </div>
            <div class="room-actions">
              <button class="btn-details" th:onclick="'viewRoomDetail(' + ${room.roomId} + ')'">상세보기</button>
              <button class="btn-join" th:onclick="'joinRoom(' + ${room.roomId} + ')'">참여 신청</button>
              <button class="btn-report" th:onclick="'reportRoom(' + ${room.roomId} + ')'">신고</button>
            </div>
          </div>
        </div>

        <!-- 방이 없을 때 표시할 메시지 -->
        <div th:if="${#lists.isEmpty(popularRooms)}" class="no-rooms-message"
             style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #64748b;">
          <h3>아직 등록된 방이 없습니다</h3>
          <p>새로운 동행자 모집방을 만들어보세요!</p>
          <a th:href="@{/rooms/create}" class="btn-primary-large" style="margin-top: 20px;">
            <span class="btn-icon">🏠</span>
            방 만들기
          </a>
        </div>

        <!-- 에러가 발생한 경우 표시 -->
        <div th:if="${roomError}" class="error-message"
             style="grid-column: 1 / -1; text-align: center; padding: 40px 20px; color: #ef4444; background: #fef2f2; border-radius: 12px;">
          <h3>데이터를 불러올 수 없습니다</h3>
          <p th:text="${roomError}">오류 메시지</p>
          <button onclick="location.reload()" class="btn-outline" style="margin-top: 16px;">
            다시 시도
          </button>
        </div>
      </div>
    </div>

    <!-- 🔥 travel-matching 섹션 맨 아래에 추가: "더 많은 방 보기" 버튼 -->
    <div class="more-rooms-section" th:if="${!#lists.isEmpty(popularRooms)}">
      <div class="more-rooms-container">
        <p class="more-rooms-text">
          더 많은 여행 동행 방들을 찾아보세요!
          <span class="total-count" th:if="${totalRoomCount != null}" th:text="'총 ' + ${totalRoomCount} + '개의 방이 있습니다.'"></span>
        </p>
        <a th:href="@{/entering-room}" class="btn-more-rooms">
          <span class="btn-icon">🔍</span>
          더 많은 방 보기
          <span class="btn-arrow">→</span>
        </a>
      </div>
    </div>

  </div>
</section>

<!-- 날씨별 여행 섹션 -->
<section class="weather-travel">
  <div class="section-container">
    <div class="section-header">
      <div class="section-badge weather-badge">
        <span class="badge-icon">🌤️</span>
        <span>날씨 맞춤 여행</span>
      </div>
      <h2 class="section-title">
        오늘 날씨에 <span class="gradient-text">딱 맞는</span> 여행지
      </h2>
      <div class="header-actions">
        <button class="btn-outline" onclick="showAllWeatherSpots()">
          <span>모든 여행지 보기</span>
          <span class="btn-arrow">→</span>
        </button>
      </div>
    </div>

    <div class="weather-content">
      <div class="weather-slider" id="weatherSlider">
        <!-- 날씨 카드들 -->
        <div class="weather-card sunny" data-weather="맑음">
          <div class="weather-image">
            <img th:src="@{/image/fix/moodtrip.png}" alt="경복궁">
            <div class="weather-overlay">
              <div class="weather-info">
                <span class="weather-icon">☀️</span>
                <span class="weather-temp">30°</span>
              </div>
            </div>
          </div>
          <div class="weather-content-area">
            <div class="weather-header">
              <h3 class="weather-title">경복궁</h3>
              <span class="weather-day">화</span>
            </div>
            <div class="weather-location">
              📍 서울특별시 종로구
            </div>
            <p class="weather-description">
              조선 왕조의 법궁에서 역사의 숨결을 느끼며 맑은 날씨와 함께 궁궐 투어를 즐겨보세요.
            </p>
            <div class="weather-tags">
              <span class="tag">역사</span>
              <span class="tag">문화</span>
              <span class="tag">사진</span>
            </div>
          </div>
        </div>

        <div class="weather-card sunny" data-weather="맑음">
          <div class="weather-image">
            <img th:src="@{/image/mainpage/sample2.png}" alt="한상수 자수 박물관">
            <div class="weather-overlay">
              <div class="weather-info">
                <span class="weather-icon">☀️</span>
                <span class="weather-temp">25°</span>
              </div>
            </div>
          </div>
          <div class="weather-content-area">
            <div class="weather-header">
              <h3 class="weather-title">한상수 자수 박물관</h3>
              <span class="weather-day">수</span>
            </div>
            <div class="weather-location">
              📍 서울특별시 성북구
              <span class="open-time">🕙 오전 10:00</span>
            </div>
            <p class="weather-description">
              전통 자수의 아름다움을 감상하며 조선시대 문화를 체험할 수 있는 특별한 공간입니다.
            </p>
            <div class="weather-tags">
              <span class="tag">전통</span>
              <span class="tag">예술</span>
              <span class="tag">체험</span>
            </div>
          </div>
        </div>

        <div class="weather-card rainy" data-weather="비">
          <div class="weather-image">
            <img th:src="@{/image/mainpage/sample3.png}" alt="보문숲길 도서관">
            <div class="weather-overlay">
              <div class="weather-info">
                <span class="weather-icon">🌧️</span>
                <span class="weather-temp">22°</span>
              </div>
            </div>
          </div>
          <div class="weather-content-area">
            <div class="weather-header">
              <h3 class="weather-title">보문숲길 도서관</h3>
              <span class="weather-day">목</span>
            </div>
            <div class="weather-location">
              📍 서울특별시 성북구 보문동
            </div>
            <p class="weather-description">
              비 오는 날에도 따뜻하고 아늑한 분위기에서 책과 함께 힐링하는 시간을 보내보세요.
            </p>
            <div class="weather-tags">
              <span class="tag">힐링</span>
              <span class="tag">독서</span>
              <span class="tag">카페</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div id="detailModal" class="modal" style="display: none;" role="dialog" aria-labelledby="detailModalTitle" aria-hidden="true">
  <div class="modal-overlay" onclick="closeDetailModal()"></div>
  <div class="modal-content detail-modal-content">
    <div class="modal-header">
      <h3 id="detailModalTitle">방 상세보기</h3>
      <button class="modal-close" onclick="closeDetailModal()" aria-label="모달 닫기">×</button>
    </div>
    <div class="modal-body">
      <div class="detail-room-image">
        <img id="detailRoomImage" src="" alt="방 이미지">
      </div>
      <div class="detail-room-info">
        <h2 id="detailRoomTitle"></h2>
        <div class="detail-room-meta">
          <div class="meta-item">
            <span class="meta-label">📍 위치</span>
            <span id="detailRoomLocation"></span>
          </div>
          <div class="meta-item">
            <span class="meta-label">📅 일정</span>
            <span id="detailRoomDate"></span>
          </div>
          <div class="meta-item">
            <span class="meta-label">👥 인원</span>
            <span id="detailRoomParticipants"></span>
          </div>
          <div class="meta-item">
            <span class="meta-label">👀 조회수</span>
            <span id="detailRoomViews"></span>
          </div>
          <div class="meta-item">
            <span class="meta-label">📆 기간</span>
            <span id="detailRoomPeriod"></span>
          </div>
        </div>
        <div class="detail-room-description">
          <h4>방 소개</h4>
          <p id="detailRoomDesc"></p>
        </div>
        <div class="detail-room-tags">
          <h4>태그</h4>
          <div class="tags-container" id="detailRoomTags"></div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-cancel" onclick="closeDetailModal()">닫기</button>
    </div>
  </div>
</div>

<!-- 입장 신청 모달 -->
<div id="applicationModal" class="modal" style="display: none;" role="dialog" aria-labelledby="applicationModalTitle" aria-hidden="true">
  <div class="modal-overlay" onclick="closeApplicationModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="applicationModalTitle">방 입장 신청</h3>
      <button class="modal-close" onclick="closeApplicationModal()" aria-label="모달 닫기">×</button>
    </div>
    <div class="modal-body">
      <!-- 방 정보 미리보기 -->
      <div class="room-info-preview">
        <h4 id="modalRoomTitle">방 제목</h4>
        <p id="modalRoomMeta">방 정보</p>
      </div>

      <div class="profile-preview">
        <h5>📝 내 자기소개 </h5>
        <div class="profile-bio-preview" id="profileBioPreview">
          <p id="currentProfileBio">반갑습니다</p>
        </div>
        <small class="text-muted">※ 방장에게 위 자기소개가 함께 전달됩니다.</small>
      </div>

      <!-- 신청 메시지 입력 -->
      <div class="application-form">
        <label for="applicationMessage">
          💬 신청 메시지
          <span class="optional-label"></span>
        </label>
        <textarea id="applicationMessage" placeholder="여행에 대한 관심사나 함께하고 싶은 이유를 적어주세요!" rows="5"></textarea>
        <div class="character-count">
          <span id="messageLength">0</span> / 300자
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-cancel" onclick="closeApplicationModal()">취소</button>
      <button class="btn btn-primary" onclick="submitApplication()">입장 신청하기</button>
    </div>
  </div>
</div>

<!-- 신고 모달 -->
<div id="reportModal" class="modal" style="display: none;" role="dialog" aria-labelledby="reportModalTitle" aria-hidden="true">
  <div class="modal-overlay" onclick="closeReportModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="reportModalTitle">방 신고하기</h3>
      <button class="modal-close" onclick="closeReportModal()" aria-label="모달 닫기">×</button>
    </div>
    <div class="modal-body">
      <div class="room-info-preview">
        <h4 id="reportRoomTitle">방 제목</h4>
        <p id="reportRoomMeta">방 정보</p>
      </div>
      <div class="report-form">
        <label for="reportReason">신고 사유</label>
        <select id="reportReason">
          <option value="">신고 사유를 선택해주세요</option>
          <option value="spam">스팸/광고</option>
          <option value="inappropriate">부적절한 내용</option>
          <option value="fraud">사기/허위정보</option>
          <option value="harassment">괴롭힘/혐오발언</option>
          <option value="other">기타</option>
        </select>
        <label for="reportMessage">상세 내용 (선택사항)</label>
        <textarea id="reportMessage" placeholder="신고 사유에 대한 자세한 내용을 입력해주세요." rows="4"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-cancel" onclick="closeReportModal()">취소</button>
      <button class="btn btn-danger" onclick="submitReport()">신고하기</button>
    </div>
  </div>
</div>
<!-- 푸터 포함 -->
<th:block th:replace="~{fix/footer :: footer}"></th:block>

<script th:src="@{/js/fix/header.js}"></script>
<script th:src="@{/js/fix/header-after.js}"></script>
<script th:src="@{/js/mainpage/mainpage.js}"></script>
</body>
</html>