<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>무드 트립 - 매칭 정보</title>
    <link rel="stylesheet" th:href="@{/css/mypage/my-matching.css}">
    <script th:src="@{/js/mypage/my-matching.js}"></script>
    <link rel=" stylesheet" th:href="@{/css/fix/header.css}">
    <link rel="stylesheet" th:href="@{/css/fix/footer.css}">
    <link rel="stylesheet" th:href="@{/css/fix/header-after.css}">
</head>
<body>
<!-- 로그인 상태에 따른 조건부 헤더 렌더링 -->
<div th:if="${isLoggedIn}">
    <!-- 로그인된 사용자용 헤더 -->
    <th:block th:replace="~{fix/header-after-login :: header}"></th:block>
</div>
<div th:unless="${isLoggedIn}">
    <!-- 로그인 안된 사용자용 헤더 -->
    <th:block th:replace="~{fix/header :: header}"></th:block>
</div>
<div>
    <div class="wrap">
        <div class="page">
            <div class="page-inner">
                <aside class="user-settings-nav">
                    <div class="account-settings">계정 설정</div>
                    <hr orientation="horizontal" class="horizontal-line">
                    <a class="my_profile active" th:href="@{/mypage/my-profile}">내 정보</a>
                    <a class="my_matching active" th:href="@{/mypage/my-matching}">매칭 정보</a>
                    <a class="join_requests active" th:href="@{/mypage/join-requests}">
                        방 입장 요청 관리
                        <span class="notification-badge" id="join-requests-badge" style="display: none;">0</span>
                    </a>
                    <a class="my_reviews active" th:href="@{/mypage/my-reviews}">내가 쓴 후기</a>
                    <a class="my_tourist_attraction_wishlist active" th:href="@{/mypage/my-tourist-attraction-wishlist}">관광지 찜 목록</a>
                    <a class="change_password active" th:href="@{/mypage/change-password}">비밀번호 변경 정보</a>
                    <a class="alarm active" th:href="@{/mypage/alarm}">알림 설정</a>
                </aside>
                <main class="mypage_info">
                    <div class="total-wrapper">
                        <h1 class="info-title">매칭 정보</h1>
                        <div class="main-wrapper">
                            <div class="tab-navigation">
                                <button class="tab-btn active" data-tab="received">내가 입장한 방</button>
                                <button class="tab-btn" data-tab="created">내가 만든 방</button>
                            </div>

                            <!-- 내가 입장한 방 탭 -->
                            <section class="tab-content active" id="received-tab">
                                <div class="matching-list-wrapper">
                                    <div class="matching-item" th:each="room : ${joinedRooms}">
                                        <div class="matching-item-inner">
                                            <div class="matching-info-section">
                                                <div class="matching-image-wrapper">
                                                    <img th:src="@{${room.imageUrl}}" th:alt="${room.title}" class="matching-image">
                                                </div>
                                                <div class="matching-details">
                                                    <h3 class="matching-title" th:text="${room.title}"></h3>
                                                    <div class="matching-meta">
                                                        <span class="host-badge">방장</span>
                                                        <span class="separator">|</span>
                                                        <span class="host-name" th:text="${room.hostName}"></span>
                                                        <span class="verification-badge" th:classappend="${room.isVerified} ? 'verified' : 'unverified'">신원 인증</span>
                                                        <span class="verification-badge" th:classappend="${room.isContactRegistered} ? 'verified' : 'unverified'">연락처 등록</span>
                                                    </div>
                                                    <div class="matching-meta-secondary">
                                                        <span class="category" th:text="${room.category}"></span>
                                                        <span class="separator">|</span>
                                                        <span class="tags" th:text="${room.tags}"></span>
                                                        <span class="location-tag" th:text="${room.location}"></span>
                                                    </div>
                                                    <p class="matching-description" th:text="${room.description}"></p>
                                                    <div class="matching-tags">
                                                        <span class="tag" th:each="tag : ${#strings.split(room.tags, ',')}" th:text="'#' + tag"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="matching-status-section">
                                                <div class="status-info">
                                                    <div class="participants-info">
                                                        <span class="label">멤버 인원</span>
                                                        <span class="count" th:text="${room.currentParticipants} + ' / ' + ${room.maxParticipants}"></span>
                                                    </div>
                                                    <div class="travel-date">
                                                        <span class="label">여행 날짜</span>
                                                        <span class="date" th:text="${room.travelDate}"></span>
                                                    </div>
                                                </div>
                                                <div class="action-buttons">
                                                    <button class="btn-chat">스케줄 짜러 가기</button>
                                                    <button class="btn-exit-room" th:attr="data-room-id=${room.roomId}" data-room-type="participant">방 나가기</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- 내가 만든 방 탭 -->
                            <section class="tab-content" id="created-tab">
                                <div class="matching-list-wrapper">
                                    <div class="matching-item" th:each="room : ${createdRooms}">
                                        <div class="matching-item-inner">
                                            <div class="matching-info-section">
                                                <div class="matching-image-wrapper">
                                                    <img th:src="@{${room.imageUrl}}" th:alt="${room.title}" class="matching-image">
                                                </div>
                                                <div class="matching-details">
                                                    <h3 class="matching-title" th:text="${room.title}"></h3>
                                                    <div class="matching-meta">
                                                        <span class="host-badge host">방장</span>
                                                        <span class="separator">|</span>
                                                        <span class="host-name" th:text="${room.hostName}"></span>
                                                        <span class="verification-badge" th:classappend="${room.isVerified} ? 'verified' : 'unverified'">신원 인증</span>
                                                        <span class="verification-badge" th:classappend="${room.isContactRegistered} ? 'verified' : 'unverified'">연락처 등록</span>
                                                    </div>
                                                    <div class="matching-meta-secondary">
                                                        <span class="category" th:text="${room.category}"></span>
                                                        <span class="separator">|</span>
                                                        <span class="tags" th:text="${room.tags}"></span>
                                                        <span class="location-tag" th:text="${room.location}"></span>
                                                    </div>
                                                    <p class="matching-description" th:text="${room.description}"></p>
                                                    <div class="matching-tags">
                                                        <span class="tag" th:each="tag : ${#strings.split(room.tags, ',')}" th:text="'#' + tag"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="matching-status-section">
                                                <div class="status-info">
                                                    <div class="participants-info">
                                                        <span class="label">멤버 인원</span>
                                                        <span class="count" th:text="${room.currentParticipants} + ' / ' + ${room.maxParticipants}"></span>
                                                    </div>
                                                    <div class="travel-date">
                                                        <span class="label">여행 날짜</span>
                                                        <span class="date" th:text="${room.travelDate}"></span>
                                                    </div>
                                                    <div class="join-requests-info">
                                                        <span class="label">대기 중인 요청</span>
                                                        <span class="count pending-requests" th:attr="data-room-id=${room.roomId}" th:text="${room.pendingRequestCount} + '건'"></span>
                                                    </div>
                                                </div>
                                                <div class="action-buttons">
                                                    <button class="btn-chat">스케줄 짜러 가기</button>
                                                    <button class="btn-manage-requests" th:attr="data-room-id=${room.roomId}" th:disabled="${room.pendingRequestCount == 0}">입장 요청 관리</button>
                                                    <button class="btn-delete-room" data-room-type="host" th:attr="data-room-id=${room.roomId}">방 삭제하기</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>
</div>
<!-- 푸터 포함 -->
<th:block th:replace="~{fix/footer :: footer}"></th:block>

<script th:src="@{/js/fix/header.js}"></script>
<script th:src="@{/js/fix/header-after.js}"></script>
</body>
</html>