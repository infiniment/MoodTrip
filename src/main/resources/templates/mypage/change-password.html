<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>비밀번호 변경</title>
    <!-- /static 제거 -->
    <link rel="stylesheet" th:href="@{/css/mypage/change-password.css}"/>
</head>
<body>
<div>
    <div class="wrap"><!--여기가 min-width : 1200px 부분-->
        <div class="page"><!-- 여기가 W-full 부분-->
            <div class="page-inner"><!--css-1jnf2ee eglsog60-->

                <aside class="user-settings-nav">
                    <div class="account-settings">계정 설정</div>
                    <hr orientation="horizontal" class="horizontal-line">
                    <a class="my_profile active" th:href="@{/mypage/my-profile}">내 정보</a>
                    <a class="my_matching active" th:href="@{/mypage/my-matching}">매칭 정보</a>
                    <a class="join_requests active" th:href="@{/mypage/join-requests}">
                        방 입장 요청 관리
                        <span class="notification-badge" id="join-requests-badge" style="display:none;">0</span>
                    </a>
                    <a class="my_tourist_attraction_wishlist active" th:href="@{/mypage/wishlist}">관광지 찜 목록</a>
                    <!-- 'provider'가 null일 때만 이 링크를 표시 -->
                    <a th:if="${#authentication.principal.provider == null}" class="change_password active" th:href="@{/mypage/change-password}">비밀번호 변경 정보</a>
                </aside>

                <main class="mypage_info"><!--css-1rr4qq7 eglsog61-->
                    <div class="total-wrapper">
                        <h1 class="change-password-title">비밀번호 변경</h1>

                        <!-- 서버 에러 메시지 (선택) -->
                        <div th:if="${error}" class="password-error" th:text="${error}"></div>

                        <form class="input-password-form-wrapper"
                              th:action="@{/mypage/change-password}"
                              method="post"
                              th:object="${form}">

                            <!-- CSRF 토큰을 올바른 위치(form 태그 바로 아래)로 이동 -->
                            <input type="hidden"
                                   th:if="${_csrf != null}"
                                   th:name="${_csrf.parameterName}"
                                   th:value="${_csrf.token}"/>

                            <!-- 상단 안내문 -->
                            <div class="flex password-warning-notification-wrapper" style="margin: 12px 0px; flex-direction: row; gap: 8px;">
                                <div class="flex password-warning-text-wrapper">
                                    <div class="flex password-warning-text" variant="caption">
                                        <div class="whitespace-pre-wrap">비밀번호를 변경하면, 로그인된 다른 디바이스에서 자동으로 로그아웃돼요.</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 현재 비밀번호 -->
                            <section class="current-password-section">
                                <label class="current-password-text-label">
                                    <span class="current-password-span-text">현재 비밀번호</span>
                                </label>
                                <div class="input-current-password-wrapper">
                                    <div class="input-current-password">
                                        <input th:field="*{currentPassword}" type="password" placeholder="기존 비밀번호를 입력해주세요." class="current-password"/>
                                    </div>
                                </div>
                                <div class="current-password-hidden-section"
                                     th:if="${#fields.hasErrors('currentPassword')}"
                                     th:errors="*{currentPassword}"></div>
                            </section>

                            <!-- 변경 비밀번호 / 확인 -->
                            <section class="change-password-section">
                                <div class="change-passowrd-wrapper">
                                    <label class="change-passowrd-label"><span class="change-passowrd-span">변경할 비밀번호</span></label>
                                    <label class="change-passowrd-label"><span class="change-passowrd-span">한번 더 입력</span></label>
                                </div>

                                <div class="input-change-password-total-wrapper">
                                    <!-- 새 비밀번호 -->
                                    <div class="input-change-password-wrapper">
                                        <div class="change-password-wrap">
                                            <div class="change-password">
                                                <input th:field="*{newPassword}" type="password" placeholder="변경할 비밀번호를 입력해주세요." class="input-change-password"/>
                                            </div>
                                        </div>
                                        <div class="change-password-hidden-section"
                                             th:if="${#fields.hasErrors('newPassword')}"
                                             th:errors="*{newPassword}"></div>
                                    </div>

                                    <!-- 새 비밀번호 확인 -->
                                    <div class="input-change-new-confirm-password-total-wrapper">
                                        <div class="input-change-new-confirm-password-wrapper">
                                            <div class="change-new-confirm-passowrd">
                                                <input th:field="*{newConfirmPassword}" type="password" placeholder="변경할 비밀번호를 한번더 입력해주세요." class="input-change-new-confirm-password"/>
                                            </div>
                                        </div>
                                        <div class="change-password-hidden-section"
                                             th:if="${#fields.hasErrors('newConfirmPassword')}"
                                             th:errors="*{newConfirmPassword}"></div>
                                    </div>
                                </div>
                            </section>

                            <!-- 서버 에러 메시지 -->
                            <div th:if="${error}" class="password-error" th:text="${error}"></div>

                            <!-- 변경하기 버튼 -->
                            <div class="change-password-button-wrapper">
                                <div style="flex-grow: 1;"></div>
                                <button role="button" type="submit" class="change-button">
                                    <span class="change-button-span">변경하기</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </main>
            </div>
        </div>
    </div>
</div>

<!-- 비밀번호 변경 성공 모달: success 가 true일 때만 노출 -->
<div class="success-modal-overlay" id="successModal" th:if="${success}">
    <div class="success-modal-container">
        <div class="success-modal-header">
            <div class="success-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" fill="#10B981"/>
                    <path d="M8 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h2 class="success-modal-title">비밀번호 변경 완료</h2>
        </div>

        <div class="success-modal-content">
            <p class="success-message">비밀번호가 성공적으로 변경되었습니다.</p>
            <p class="success-sub-message">보안을 위해 다른 디바이스에서 자동으로 로그아웃됩니다.</p>
        </div>

        <div class="success-modal-footer">
            <button class="success-confirm-btn" id="successConfirm" type="button">확인</button>
        </div>
    </div>
</div>

<script th:src="@{/js/mypage/change-password.js}"></script>
</body>
</html>
