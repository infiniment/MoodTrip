<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>무드트립 : 동행자 매칭 방 만들기 관광지 선택</title>
    <link rel="stylesheet" th:href="@{/css/creatingRoom/choosing-attraction.css}">
    <link rel=" stylesheet" th:href="@{/css/fix/header.css}">
    <link rel="stylesheet" th:href="@{/css/fix/footer.css}">
    <link rel="stylesheet" th:href="@{/css/fix/header-after.css}">
    <script th:src = "@{/js/creatingRoom/choosing-attraction.js}"></script>
</head>
<body class="room-create phase-3">
<!-- 로그인 상태에 따른 조건부 헤더 렌더링 -->
<div th:if="${isLoggedIn}">
    <!-- 로그인된 사용자용 헤더 -->
    <th:block th:replace="~{fix/header-after-login :: header}"></th:block>
</div>
<div th:unless="${isLoggedIn}">
    <!-- 로그인 안된 사용자용 헤더 -->
    <th:block th:replace="~{fix/header :: header}"></th:block>
</div>

    <div class="big-frame">
        <div class="room-create-formview">
            <div class="container">
                <div class="submit-progress">
                    <div class="room-status-box">
                        <a class="back-to-before link-text" onclick="goToPreviousPage()" style="cursor:pointer;">
                            <img class="back-to-before-img" th:src="@{/image/creatingRoom/back-to-before.svg}">
                            <p class="back-to-before-title body-1-medium">뒤로 가기</p>
                        </a>
                        <p class="menu-title subtitle-1-medium mb4">관광지 선택하기</p>
                    </div>
                    <div class="input-group-status">
                        <p class="status-main-menu active body-2">방 상세 정보 입력</p>
                        <div class="status-sub-menu">
                            <p class="status-sub-menu-title completed">
                                <span class="bottom-border"></span>
                                <span class="sub-menu-marker">1</span>
                                <img class="phase-complete-icon" th:src="@{/image/creatingRoom/checkbox-checked.svg}">기본 정보
                            </p>
                            <p class="status-sub-menu-title completed">
                                <span class="top-border"></span><span class="bottom-border"></span>
                                <span class="sub-menu-marker">2</span>
                                <img class="phase-complete-icon" th:src="@{/image/creatingRoom/checkbox-checked.svg}">감정 선택
                            </p>
                            <p class="status-sub-menu-title active">
                                <span class="top-border"></span><span class="bottom-border"></span>
                                <span class="sub-menu-marker">3</span>
                                <img class="phase-complete-icon" th:src="@{/image/creatingRoom/checkbox-checked.svg}">관광지 선택
                            </p>
                            <p class="status-sub-menu-title">
                                <span class="top-border"></span>
                                <span class="sub-menu-marker">4</span>
                                <img class="phase-complete-icon" th:src="@{/image/creatingRoom/checkbox-checked.svg}">일정 선택
                            </p>
                        </div>
                        <p class="status-main-menu status-menu-with-tooltip body-2">방 최종 등록</p>
                    </div>
                </div>

                <!-- 서버 제출용 폼은 유지(다음 단계로 이동 시 hidden 채우는 용도) -->
                <form autocomplete="off" enctype="multipart/form-data"
                      id="temporary_room_phase_3" method="POST"
                      onsubmit="return validationPhase(this);">

                    <!-- CSRF: 활성화된 경우에만 렌더 -->
                    <input type="hidden"
                           th:if="${_csrf != null}"
                           th:name="${_csrf.parameterName}"
                           th:value="${_csrf.token}"/>

                    <div class="room-create-form-section">
                        <div class="form-section-header">
                            <p class="form-section-title subtitle-1">관광지 선택</p>
                            <button class="room-form-guide-button header-button btn btn-8-16" type="button" onclick="openHelpModal()">
                                <img class="room-form-guide-button-img" th:src="@{/image/creatingRoom/question.svg}">도움말
                            </button>
                        </div>

                        <div class="form-input-section">
                            <div class="form-group-light">
                                <label class="form-group-title body-1-bold">
                                    가고 싶은 관광지 선택 <span class="required">*</span>
                                </label>

                                <form id="searchForm"
                                      th:action="@{/companion-rooms/attraction}"
                                      method="get"
                                      class="roomName-search-form theme-client mb8"
                                      autocomplete="off">
                                    <div class="roomName-search-typing-box">
                                        <div class="roomName-search-input-group">
                                            <i class="search_icon"><img class="text-icon" th:src="@{/image/creatingRoom/search.svg}"></i>
                                            <div class="roomName-search-selected"></div>
                                            <input class="roomName-search-typing-input theme-client body-2"
                                                   id="destinationInput" name="q"
                                                   placeholder="가고싶은 관광지를 선택해주세요 ex ) 고양시"
                                                   type="text" th:value="${q}">
                                        </div>
                                    </div>
                                </form>
                            </div>



                            <!-- 검색 결과 -->
                            <div class="form-group-light">
                                <label class="form-group-title body-1-bold mb4">관광지 검색 결과</label>
                                <p class="mb16 body-2 text900"
                                   th:text="${#lists.size(attractions)} + '개 검색어 추천'">0개 검색어 추천</p>

                                <div class="destination-filter mb16">
                                    <select class="filter-select" id="regionFilter">
                                        <option value="">추천순</option>
                                        <option value="distance">거리순</option>
                                    </select>
                                </div>

                                <div class="destination-results-grid mb32" id="destinationResults">
                                    <div class="empty" th:if="${#lists.isEmpty(attractions)}">
                                        검색 결과가 없습니다. 다른 키워드로 검색해보세요.
                                    </div>

                                    <!-- 결과 카드 -->
                                    <div class="destination-card"
                                         th:each="a, iStat : ${attractions}"
                                         th:attr="data-destination=${a.title}">
                                        <input type="radio"
                                               class="destination-radio"
                                               name="destination"
                                               th:id="'dest-' + ${iStat.index}"
                                               th:value="${a.title}">
                                        <label class="destination-label"
                                               th:for="'dest-' + ${iStat.index}"
                                               th:with="
         rawDesc=${#strings.defaultString(a.tel, a.addr2)},
         desc=${#strings.trim(#strings.replace(#strings.replace(rawDesc,'<br/>',' '),'<br>',' '))}
       ">
                                            <div class="destination-image">
                                                <!-- 이미지가 있을 때 -->
                                                <img th:if="${!#strings.isEmpty(a.firstImage)}"
                                                     th:src="${a.firstImage}"
                                                     th:alt="${a.title}"
                                                     loading="lazy" decoding="async"
                                                     onerror="this.onerror=null; this.src='/image/creatingRoom/landscape-placeholder-svgrepo-com.svg';" />

                                                <!-- 이미지가 없을 때 -->
                                                <img th:if="${#strings.isEmpty(a.firstImage)}"
                                                     th:src="@{/image/creatingRoom/landscape-placeholder-svgrepo-com.svg}"
                                                     th:alt="${a.title}" />
                                            </div>
                                            <div class="destination-info">
                                                <div class="destination-category"
                                                     th:text="${#strings.defaultString(a.addr1, '주소 정보 없음')}"></div>
                                                <div class="destination-name" th:text="${a.title}"></div>
                                                <div class="destination-description"
                                                     th:if="${!#strings.isEmpty(desc) and #strings.toLowerCase(desc) != 'null'}"
                                                     th:text="${desc}">
                                                </div>
                                            </div>
                                        </label>

                                        <!-- 메타 데이터 (JS가 읽음) -->
                                        <div class="hidden"
                                             th:attr="
                             data-content-id=${a.contentId},
                             data-title=${a.title},
                             data-addr1=${a.addr1},
                             data-addr2=${a.addr2},
                             data-img=${a.firstImage},
                             data-mapx=${a.mapX},
                             data-mapy=${a.mapY},
                             data-type=${a.contentTypeId}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 페이징 섹션 -->
                            <div class="pagination-container" id="paginationContainer" hidden>
                                <nav class="pagination" aria-label="페이지 네비게이션">
                                    <button class="pagination-button prev" type="button" disabled>
                                        <svg class="pagination-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <polyline points="15,18 9,12 15,6"></polyline>
                                        </svg>
                                        이전
                                    </button>

                                    <div class="pagination-numbers"><!-- JS가 페이지 번호 버튼을 채움 --></div>

                                    <button class="pagination-button next" type="button">
                                        다음
                                        <svg class="pagination-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <polyline points="9,18 15,12 9,6"></polyline>
                                        </svg>
                                    </button>
                                </nav>

                                <div class="pagination-info">
                                    <span class="range">0 - 0 / <strong class="total">0</strong>개</span>
                                </div>
                            </div>

                            <!-- 선택된 관광지 표시 -->
                            <div class="selected-destination-container" id="selectedDestinationContainer" style="display:none;">
                                <h4 class="selected-destination-title">선택된 관광지</h4>
                                <div class="selected-destination-info" id="selectedDestinationInfo"></div>
                            </div>

                            <!-- hidden inputs (다음 단계/제출용) -->
                            <input type="hidden" id="destContentId" name="destination.contentId">
                            <input type="hidden" id="destTitle"     name="destination.name">
                            <input type="hidden" id="destAddr"      name="destination.addr">
                            <input type="hidden" id="destImage"     name="destination.image">
                            <input type="hidden" id="destLat"       name="destination.lat">
                            <input type="hidden" id="destLon"       name="destination.lon">
                            <input type="hidden" id="destCategory"  name="destination.category" value="ATTRACTION">

                            <div class="form-section-footer" style="position:sticky;bottom:0;background-color:white;z-index:50">
                                <!-- 🔧 실제 제출 막고 JS로만 이동 -->
                                <button class="btn btn-client btn-11-24 btn-right" type="button" id="nextButton">다음</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- 관광지 선택 도움말 모달 -->
    <div id="helpModal" class="help-modal" style="display: none;">
        <div class="help-modal-overlay" onclick="closeHelpModal()"></div>
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3>관광지 선택 도움말</h3>
                <button class="help-modal-close" onclick="closeHelpModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="#666" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>

            <div class="help-modal-body">
                <div class="help-section">
                    <h4>📍 관광지 선택이란?</h4>
                    <div class="destination-explanation">
                        <p>선택한 <strong>감정에 맞는 관광지</strong>를 찾아 동행자들과 함께 의미 있는 시간을 보낼 장소를 정하는 단계입니다.</p>
                        <p>감정과 관광지가 조화를 이룰 때 더욱 특별한 여행 경험을 만들 수 있어요!</p>
                    </div>
                </div>

                <div class="help-section">
                    <h4>🗺️ 감정별 추천 관광지</h4>
                    <div class="destination-categories">
                        <div class="destination-category-card positive-places">
                            <h5>😊 긍정 에너지 충전지</h5>
                            <div class="place-types">
                                <span class="place-tag energy">테마파크</span>
                                <span class="place-tag energy">축제장</span>
                                <span class="place-tag energy">스포츠 경기장</span>
                                <span class="place-tag energy">액티비티 센터</span>
                            </div>
                            <p class="destination-description">신나고 활동적인 장소에서 에너지를 발산하고 새로운 추억을 만들어보세요!</p>
                        </div>

                        <div class="destination-category-card healing-places">
                            <h5>🌿 힐링 & 휴식공간</h5>
                            <div class="place-types">
                                <span class="place-tag healing">자연 공원</span>
                                <span class="place-tag healing">호수 & 강변</span>
                                <span class="place-tag healing">온천 & 스파</span>
                                <span class="place-tag healing">조용한 카페</span>
                            </div>
                            <p class="destination-description">마음의 평화를 찾고 지친 마음을 달래는 관광지로 떠나보세요!</p>
                        </div>

                        <div class="destination-category-card cultural-places">
                            <h5>🎨 문화 & 감성여행</h5>
                            <div class="place-types">
                                <span class="place-tag cultural">박물관 & 미술관</span>
                                <span class="place-tag cultural">역사 유적지</span>
                                <span class="place-tag cultural">공연장 & 극장</span>
                                <span class="place-tag cultural">전통 마을</span>
                            </div>
                            <p class="destination-description">깊이 있는 대화와 사색의 시간을 가질 수 있는 문화적 공간들이에요!</p>
                        </div>

                        <div class="destination-category-card urban-places">
                            <h5>🏙️ 도심 & 모던여행</h5>
                            <div class="place-types">
                                <span class="place-tag urban">쇼핑몰 & 백화점</span>
                                <span class="place-tag urban">루프탑 카페</span>
                                <span class="place-tag urban">전시 컨벤션</span>
                                <span class="place-tag urban">트렌디한 거리</span>
                            </div>
                            <p class="destination-description">도시의 활기를 느끼며 트렌드를 공유하고 새로운 경험을 해보세요!</p>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h4>🔍 효과적인 검색 방법</h4>
                    <div class="search-tips">
                        <div class="tip-item">
                            <div class="tip-icon">📱</div>
                            <div class="tip-content">
                                <strong>키워드 조합</strong>
                                <p>지역명 + 관심사로 검색해보세요. 예: "강남 카페", "부산 해변", "제주 액티비티"</p>
                            </div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">🎯</div>
                            <div class="tip-content">
                                <strong>구체적 장소명</strong>
                                <p>특정 장소가 있다면 정확한 이름으로 검색하면 더 정확한 결과를 얻을 수 있어요</p>
                            </div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">🌍</div>
                            <div class="tip-content">
                                <strong>다양한 표현 시도</strong>
                                <p>"서울 명동" 대신 "명동 쇼핑", "명동 거리" 등 다양하게 검색해보세요</p>
                            </div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">🚇</div>
                            <div class="tip-content">
                                <strong>접근성 고려</strong>
                                <p>대중교통이나 자동차로 접근 가능한지 미리 확인해보세요</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h4>✨ 관광지 선택 꿀팁</h4>
                    <div class="selection-strategies">
                        <div class="strategy-card">
                            <h5>💡 감정 매칭</h5>
                            <div class="strategy-content">
                                <p><strong>이전 단계에서 선택한 감정을 참고하세요!</strong></p>
                                <div class="emotion-place-matches">
                                    <div class="match-item">
                                        <span class="emotion-tag">행복 + 즐거움</span>
                                        <span class="arrow">→</span>
                                        <span class="place-suggestion">놀이공원, 축제, 스포츠 관람</span>
                                    </div>
                                    <div class="match-item">
                                        <span class="emotion-tag">편안함 + 차분함</span>
                                        <span class="arrow">→</span>
                                        <span class="place-suggestion">공원, 호수, 조용한 카페</span>
                                    </div>
                                    <div class="match-item">
                                        <span class="emotion-tag">설렘 + 자신감</span>
                                        <span class="arrow">→</span>
                                        <span class="place-suggestion">새로운 체험, 모험 활동</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="strategy-card">
                            <h5>👥 동행자 고려사항</h5>
                            <div class="strategy-content">
                                <ul class="consideration-list">
                                    <li><span class="bullet">🕐</span> 모임 시간과 장소의 편의성</li>
                                    <li><span class="bullet">💰</span> 예상 비용과 부담 정도</li>
                                    <li><span class="bullet">🚶</span> 체력적 요구사항과 난이도</li>
                                    <li><span class="bullet">📷</span> 사진 촬영과 추억 만들기 가능성</li>
                                    <li><span class="bullet">☔</span> 날씨의 영향 정도</li>
                                </ul>
                            </div>
                        </div>

                        <div class="strategy-card">
                            <h5>🎈 분위기별 추천</h5>
                            <div class="mood-suggestions">
                                <div class="mood-item">
                                    <div class="mood-icon">☀️</div>
                                    <div class="mood-info">
                                        <strong>활기찬 분위기</strong>
                                        <p>쇼핑몰, 시장, 번화가, 펍</p>
                                    </div>
                                </div>
                                <div class="mood-item">
                                    <div class="mood-icon">🌙</div>
                                    <div class="mood-info">
                                        <strong>조용한 분위기</strong>
                                        <p>도서관, 갤러리, 조용한 카페</p>
                                    </div>
                                </div>
                                <div class="mood-item">
                                    <div class="mood-icon">🎪</div>
                                    <div class="mood-info">
                                        <strong>특별한 분위기</strong>
                                        <p>테마파크, 전시회, 콘서트홀</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="help-section">
                    <h4>💼 실용적인 준비사항</h4>
                    <div class="practical-tips">
                        <div class="prep-category">
                            <h6>📋 사전 확인사항</h6>
                            <div class="prep-items">
                                <span class="prep-tag">영업시간</span>
                                <span class="prep-tag">입장료</span>
                                <span class="prep-tag">예약 필요 여부</span>
                                <span class="prep-tag">주차 가능 여부</span>
                            </div>
                        </div>
                        <div class="prep-category">
                            <h6>🎒 준비물 체크</h6>
                            <div class="prep-items">
                                <span class="prep-tag">편한 신발</span>
                                <span class="prep-tag">충전기</span>
                                <span class="prep-tag">카메라</span>
                                <span class="prep-tag">여분 옷</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="help-modal-footer">
                <div class="help-footer-info">
                    <p>🎯 감정에 딱 맞는 관광지로 특별한 만남을 시작해보세요!</p>
                </div>
            </div>
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        try {
            const emotionsFromLocal = localStorage.getItem('selected_emotions_step2');
            const emotionsFromSession = sessionStorage.getItem('selected_emotions_step2');
            if (emotionsFromLocal) console.log('[localStorage] 선택된 감정 목록:', JSON.parse(emotionsFromLocal));
            else console.log('[localStorage] 선택된 감정 없음');
            if (emotionsFromSession) console.log('[sessionStorage] 선택된 감정 목록:', JSON.parse(emotionsFromSession));
            else console.log('[sessionStorage] 선택된 감정 없음');
        } catch (e) {
            console.error('감정 데이터 파싱 오류:', e);
        }
    });
</script>
<th:block th:replace="~{fix/footer :: footer}"></th:block>
<script th:src="@{/js/fix/header.js}"></script>
<script th:src="@{/js/fix/header-after.js}"></script>
</body>
</html>